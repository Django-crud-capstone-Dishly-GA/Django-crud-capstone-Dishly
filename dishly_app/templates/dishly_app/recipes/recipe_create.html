{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static "css/form.css" %}" />
{% endblock head %}

{% block content %}
<section class="dishly-form-page">
  <div class="dishly-form-card">
    {% if recipe %}
      <h1 class="dishly-form-title">üç≥ Edit {{ recipe.name }}</h1>
    {% else %}
      <h1 class="dishly-form-title">üç≥ Add a New Recipe</h1>
    {% endif %}
    <p class="dishly-form-subtitle">Share your favorite dish with the Hungry Team community!</p>

    <form action="" method="post" class="dishly-form-container">
      {% csrf_token %}
      <table class="dishly-form-table">
        <tr>
          <th>Name:</th>
          <td>{{ form.name }}</td>
        </tr>
         <tr>
          <th> Recipe Image :</th>
          <td>{{ form.image_url }}</td>
        </tr>
        <tr>
          <th>Description:</th>
          <td>{{ form.description }}</td>
        </tr>
        <tr>
          <th>Category:</th>
          <td>{{ form.category }}</td>
        </tr>
        <tr>
          <th>Ingredients:</th>
          <td>
            <input type="text" id="ingredient-search" class="dishly-search-input" placeholder="üîç Search ingredients...">
            <div class="dishly-checkbox-list">
              {{ form.ingredients }}
            </div>
          </td>
        </tr>
      </table>

      <button type="submit" class="dishly-btn dishly-submit-btn">Submit Recipe</button>
    </form>
  </div>
</section>

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const search = document.getElementById("ingredient-search");
  if (!search) return;

  // Find the first container that holds the checkboxes (ul OR div)
  const root =
    document.querySelector(".dishly-checkbox-list ul") ||
    document.querySelector(".dishly-checkbox-list");

  if (!root) return;

  // Build a list of {li, label} pairs to filter robustly
  const pairs = Array.from(
    root.querySelectorAll("li, label") // handle <ul><li><label>‚Ä¶</label></li> OR flat labels
  ).map(node => {
    const li = node.closest("li") || node;                 // li if exists, else the node itself
    const label = li.querySelector("label") || li;         // label if exists, else the li
    return { li, label };
  }).filter(p => p.label && p.li);

  // Prevent Enter in search from submitting the form
  search.addEventListener("keydown", e => {
    if (e.key === "Enter") e.preventDefault();
  });

  const filter = (q) => {
    const needle = q.trim().toLowerCase();
    pairs.forEach(({ li, label }) => {
      const text = (label.textContent || "").trim().toLowerCase();
      li.style.display = (!needle || text.includes(needle)) ? "" : "none";
    });
  };

  // initial + live filtering
  filter(search.value || "");
  search.addEventListener("input", e => filter(e.target.value));
});
</script>
{% endblock %}
{% endblock content %}


