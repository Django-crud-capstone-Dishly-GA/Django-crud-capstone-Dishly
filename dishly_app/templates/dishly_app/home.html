{% extends "base.html" %}
{% load static %}

{% block content %}
<h1 class="text-center page-title">Welcome to Dishly ğŸ³</h1>

{% if user.is_authenticated %}
  <div class="create-btn-wrapper">
    <a href="{% url 'recipe-create' %}">
      <button class="btn primary">â• Create a Recipe</button>
    </a>
  </div>
{% else %}
  <h2 class="text-center login-message">Login to Create a Recipe</h2>
{% endif %}

<p class="text-center tagline">Your personal recipe collection app.</p>

<!-- === SEARCH BAR === -->
<form class="search-bar" method="GET" action="{% url 'recipe-list' %}">
  <input class="search-input" type="search" name="search" placeholder="Search recipes... ğŸ”" value="{{ request.GET.search }}">
</form>

<h2 class="section-title">ğŸ½ All Recipes</h2>
{% for recipe in object_list %}
<section class="recipe-showcase">
  <div class="showcase-container">
    <div class="showcase-image">
      {% if recipe.image_url %}
        <img src="{{ recipe.image_url }}" alt="{{ recipe.name }}" onerror="this.onerror=null;this.src='{% static 'images/placeholder.png' %}';">
      {% else %}
        <img src="{% static 'images/placeholder.png' %}" alt="No image">
      {% endif %}
    </div>

    <div class="showcase-content">
      <h2>{{ recipe.name }} - By {{ recipe.user.username }}</h2>
      <p class="description">{{ recipe.description }}</p>

      <div class="ingredients">
        <h4>Ingredients:</h4>
        {% for ingredient in recipe.ingredients.all %}
          <p>{{ ingredient.name }}</p>
        {% empty %}
          <p>No ingredients listed.</p>
        {% endfor %}
      </div>

      {% if user.is_authenticated %}
        <form class="like-form" data-recipe-id="{{ recipe.id }}" method="post" action="{% url 'like-recipe' recipe.id %}">
          {% csrf_token %}
          {% if user in recipe.likes.all %}
            <button type="submit" class="like-btn liked">ğŸ’” Unlike</button>
          {% else %}
            <button type="submit" class="like-btn">ğŸ‘ Like</button>
          {% endif %}
          <p><span class="like-count">{{ recipe.total_likes }}</span> Likes</p>
        </form>
      {% else %}
        <p><a href="{% url 'login' %}"><button class="btn login">Login</button></a> to like this recipe.</p>
      {% endif %}

      <div class="recipe-actions">
        <a href="{% url 'recipe-detail' recipe.id %}">
          <button class="btn secondary">ğŸ‘ View Full Recipe</button>
        </a>
      </div>
    </div>
  </div>
</section>
{% empty %}
<p class="text-center">No recipes available yet.</p>
{% endfor %}

<script>
  // we added this script to make the search bar interactive and more fun to use
const searchInput = document.querySelector('.search-input');
const searchForm = document.querySelector('.search-bar');
const recipeSections = document.querySelectorAll('.recipe-showcase');
const noResultsMsg = document.querySelector('.no-results-msg');



searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase().trim();

  recipeSections.forEach(section => {
    const title = section.querySelector('h2').textContent.toLowerCase();
    section.style.display = title.includes(query) || query === "" ? "" : "none";
  });
});


searchForm.addEventListener('submit', (e) => {
  if (!searchInput.value.trim()) {
    e.preventDefault();
    return;
  }

  const anyVisible = [...recipeSections].some(s => s.style.display !== 'none');

});
</script>

{% endblock %}