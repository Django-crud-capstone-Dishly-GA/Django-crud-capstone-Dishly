{% extends "base.html" %}{% load static %}


{% block content %}
<h1 class="text-center page-title">My Recipes üç≥</h1>
 {% for recipe in recipes %}
    
<section class="recipe-showcase">
  <div class="showcase-container">
    <div class="showcase-image">
      {% if recipe.image_url %}
        <img src="{{ recipe.image_url }}" alt="{{ recipe.name }}" onerror="this.onerror=null;this.src='{% static 'images/placeholder.png' %}';">
      {% else %}
        <img src="{% static 'images/placeholder.png' %}" alt="No image">
      {% endif %}
    </div>
    <div class="showcase-content">
      <h2>{{recipe.name}} - By {{recipe.user.username}}</h2>
      <p class="description">
       {{recipe.description}}
      </p>

      <div class="ingredients">
        <h4>ingredients:</h4>
         {% for ingredient in recipe.ingredients.all %}
              <p>{{ ingredient.name }}</p>
           {% empty %}
              <li>No ingredients listed.</li>
              {% endfor %}


     {% if user.is_authenticated %}
      <div class="actions">
        
      <a href="{% url "recipe-update" recipe.id %}">  <button class="btn secondary">Edit Recipe</button> </a>
      <a href="{% url "recipe-delete" recipe.id %}">  <button class="btn secondary">Delete Recipe</button> </a>
       <form action="{% url 'like-recipe' recipe.id %}" method="post">
    {% csrf_token %}
    {% if user.is_authenticated %}
        {% if user in recipe.likes.all %}
            <button type="submit" class="btn btn-danger">üíî Unlike</button>
        {% else %}
            <button type="submit" class="btn btn-primary">‚ù§Ô∏è Like</button>
        {% endif %}
        <p>{{ recipe.total_likes }} likes</p>
    {% else %}
        <p><a href="{% url 'login' %}">Log in</a> to like this recipe.</p>
    {% endif %}
</form>
      </div>
       {% else %}
        <h4>Login to see the Edit/Delete</h4>
      {% endif %}
  </div>
</section>


 {% endfor %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const search = document.getElementById("ingredient-search");
  if (!search) return;

  // Find the first container that holds the checkboxes (ul OR div)
  const root =
    document.querySelector(".dishly-checkbox-list ul") ||
    document.querySelector(".dishly-checkbox-list");

  if (!root) return;

  // Build a list of {li, label} pairs to filter robustly
  const pairs = Array.from(
    root.querySelectorAll("li, label") // handle <ul><li><label>‚Ä¶</label></li> OR flat labels
  ).map(node => {
    const li = node.closest("li") || node;                 // li if exists, else the node itself
    const label = li.querySelector("label") || li;         // label if exists, else the li
    return { li, label };
  }).filter(p => p.label && p.li);

  // Prevent Enter in search from submitting the form
  search.addEventListener("keydown", e => {
    if (e.key === "Enter") e.preventDefault();
  });

  const filter = (q) => {
    const needle = q.trim().toLowerCase();
    pairs.forEach(({ li, label }) => {
      const text = (label.textContent || "").trim().toLowerCase();
      li.style.display = (!needle || text.includes(needle)) ? "" : "none";
    });
  };

  // initial + live filtering
  filter(search.value || "");
  search.addEventListener("input", e => filter(e.target.value));
});
</script>
{% endblock %}


 {% endblock %}